@(wallId:Long, pref:WallPreference, sheets:List[Sheet], timestamp:Long, chatId:Long)(implicit loginForm:Form[LoginData], request: play.api.mvc.Request[play.api.mvc.AnyContent]) 

@layouts.stage("Wall ::: Infinite Wall") {

<input id="fileupload" type="file" name="files[]" data-url="/file" multiple>

<div id="wall">
	<div id="scaleLayer">
    <div id ="moveLayer">
      <div id="linkLayer"></div>
      <div id="sheetLayer"></div>
		</div>
	</div>
	<div contenteditable=true id="wallPasteArea"></div>
</div>

<div id = "rightBar">
  <div id="toolBar">
    <img id="zoomIcon" src="@routes.Assets.at("images/zoomIcon.png")"></img>
    <p id="zoomLevelText">100%</p>
    <img class="createBtn" rel="text" src="@routes.Assets.at("images/createSheet.png")"></img>
    <img id="minimapBtn" src="@routes.Assets.at("images/minimap.png")"></img>
    <img id="folderBtn" src="@routes.Assets.at("images/folder.png")"></img>
  </div>
  <div id = "miniMap">
    <div id = "minimapWorld">
      <div id = "minimapElements"></div>
      <div id = "minimapCurrentScreen"></div>
    </div>
  </div>
  <div id = "chatWindow">
    <div id="chat-userlist">
      <ul id="users" class="unstyled">
      </ul>
    </div>
    <div id="log">
    </div>
    <div id = "chatInputContainer">
      <textarea id="talk"></textarea>
    </div>
  </div>
</div>

<div id="wallmanagement">
  <div id="folder-test">
  </div>
</div>

<script type="text/javascript">


  $(function()
  {
    $('#logoImage').attr('href', 'javascript:')
    $('#wallmanagement').appendTo($("#logoMenu"))

    $('#logoImage').click(function() {
      $('#wallmanagement').toggle()
    })

  })

  // initialize wall socket/events
  var wallSocket = new window.WallSocket("@routes.Wall.sync(wallId, timestamp).webSocketURL()")
  wallSocket.on('receivedAction', function(detail, isMine) {
    isMine = isMine || false
    var sheet = sheets[detail.params.id];

    if(isMine && detail.action == "alterText")
      sheet.alterText(detail.params, isMine)
    else if(detail.action == "create")
      createSheet(detail.id, detail.params);
    else if(detail.action == "move")
      sheet.move(detail.params);
    else if(detail.action == "resize")
      sheet.resize(detail.params);
    else if(detail.action == "remove")
      sheet.remove(detail.params);
    // deprecated:
    // else if(detail.action == "setText")
    //   sheet.setText(detail.params);
    else if(detail.action == "alterText")
      sheet.alterText(detail.params)
    else if(detail.action == "setTitle")
      sheet.setTitle(detail.params);
  })

  // initialize chat socket
  var chatSocket = new window.ChatSocket("@routes.Chat.establish(chatId, 999).webSocketURL()")

  // initialize current stage
  $(function() {	
    var sheets = []

    @sheets.map { sheet => 
      sheets.push(@Html(sheet.toJson()))
    }

    for(var i = 0; i < sheets.length; i++)  {	
      var sheet = sheets[i]
      console.log(sheet)
      createSheet(sheet.id, sheet)
    }
    /*
    $('.sheetTextField').redactor({
      autoresize: true,
      air: true,
      airButtons: ['formatting', '|', 'bold', 'italic', 'deleted']
    });	
    */

    glob.zoomLevel = @pref.zoom;
    $('#scaleLayer').css('scale', glob.zoomLevel)
    $('#moveLayer').css('x', @pref.panX)
    $('#moveLayer').css('y', @pref.panY)


    $.getJSON('/tree', function(data) {
      // folder test
      var fv = new FolderView(data);
      fv.appendTo($('#folder-test'))

    })



    // wall ready
    $(document).trigger("wallready")
  })
</script>

}
